<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Assistente Canaris</title>
  <style>
    :root{
      --bg:#0b0b0b;
      --card:#141414;
      --text:#f2f2f2;
      --muted:#b8b8b8;
      --accent:#22c55e;
      --danger:#ef4444;
      --border:#2a2a2a;
      --radius:18px;
      --pad:16px;
      --shadow: 0 10px 25px rgba(0,0,0,.35);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    body{
      margin:0;
      background:linear-gradient(180deg, #050505, #0b0b0b);
      color:var(--text);
      min-height:100vh;
      display:flex;
      justify-content:center;
    }
    .app{
      width: min(520px, 100%);
      padding: env(safe-area-inset-top) 12px env(safe-area-inset-bottom) 12px;
    }

    /* TOPBAR */
    .topbar{
      padding: 14px var(--pad);
      display:flex;
      align-items:center;
      gap:12px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .brandLogo{
      width:36px;height:36px;border-radius:12px;
      border:1px solid var(--border);
      background: #0f0f0f;
      box-shadow: var(--shadow);
      object-fit:contain;
      padding:6px;
    }
    .title{
      font-size:13px;
      letter-spacing:.10em;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .card{
      margin: 10px var(--pad) 0 var(--pad);
      background: rgba(20,20,20,.85);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .screen{
      padding: 18px;
    }

    /* HOME / HERO */
    .hero{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:12px;
      min-height: 56vh;
      text-align:center;
    }
    .heroLogoBig{
      width:120px;
      height:48px;
      object-fit:contain;
      margin-bottom:4px;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));
    }
    .camIcon{
      width:78px;height:78px;border-radius:22px;
      border:1px solid var(--border);
      background: linear-gradient(180deg, #1d1d1d, #101010);
      display:grid;place-items:center;
      font-size:32px;
    }
    h1{
      margin:0;
      font-size:20px;
      letter-spacing:.01em;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size:14px;
      line-height:1.35;
      max-width: 340px;
    }
    .hint{
      margin-top:8px;
      color:#9ca3af;
      font-size:12px;
    }

    /* BUTTONS */
    .actions{
      display:flex;
      flex-direction:column;
      gap:10px;
      width:100%;
      margin-top:14px;
    }
    button{
      border:0;
      border-radius:16px;
      padding:14px 14px;
      font-weight:800;
      font-size:15px;
      cursor:pointer;
    }
    .primary{
      background: var(--accent);
      color:#06120a;
    }
    .secondary{
      background: transparent;
      color: var(--text);
      border:1px solid var(--border);
    }
    .danger{
      background: transparent;
      color: var(--danger);
      border:1px solid rgba(239,68,68,.35);
    }

    /* PREVIEW */
    .previewWrap{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .previewImg{
      width:100%;
      border-radius: 16px;
      border:1px solid var(--border);
      background:#0f0f0f;
      max-height: 55vh;
      object-fit: contain;
    }
    .row{
      display:flex;
      gap:10px;
    }
    .row button{ flex:1; }

    /* SEARCH (FILTRI / CODICE) */
    .sectionTitle{
      font-size:16px;
      font-weight:900;
      margin:0 0 6px 0;
    }
    .sectionSub{
      margin:0 0 14px 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
    }
    .panel{
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px;
      background: rgba(10,10,10,.45);
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    label{
      font-size:12px;
      color:#d1d5db;
      font-weight:800;
      letter-spacing:.04em;
    }
    select, input{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:#0f0f0f;
      color:var(--text);
      font-size:14px;
      outline:none;
    }
    .divider{
      height:1px;
      background: var(--border);
      margin: 10px 0;
      opacity:.7;
    }
    .mini{
      font-size:12px;
      color:#9ca3af;
      margin:0;
    }

    /* RESULTS */
    .resultsHeader{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      margin-bottom:12px;
    }
    .badge{
      font-size:12px;
      color:#0b0b0b;
      background:#f2f2f2;
      border-radius:999px;
      padding:6px 10px;
      font-weight:900;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    .item{
      display:flex;
      gap:12px;
      padding:12px;
      border:1px solid var(--border);
      border-radius:16px;
      background: rgba(10,10,10,.45);
    }
    .thumb{
      width:74px;height:96px;
      border-radius:14px;
      border:1px solid var(--border);
      background: linear-gradient(180deg, #1b1b1b, #0e0e0e);
      display:grid;place-items:center;
      color:#9ca3af;
      font-size:12px;
      flex:0 0 auto;
    }
    .meta{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:0;
    }
    .name{
      font-weight:900;
      font-size:14px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .line{
      color:var(--muted);
      font-size:13px;
    }
    .stock{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:4px;
    }
    .pill{
      font-size:12px;
      padding:5px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      color:#d1d5db;
      background: rgba(255,255,255,.03);
    }
    .pill.ok{
      border-color: rgba(34,197,94,.4);
      color:#bbf7d0;
    }
    .foot{
      display:flex;
      gap:10px;
      margin-top:12px;
    }
    .foot button{ flex:1; }

    .status{
      padding: 14px 18px;
      border-top:1px solid var(--border);
      color: var(--muted);
      font-size:13px;
    }
    .hidden{ display:none; }
  </style>
</head>

<body>
  <div class="app">
    <div class="topbar">
      <div class="brand">
        <!-- LOGO PICCOLO (TOPBAR) -->
        <img class="brandLogo" src="logo-canaris.png" alt="Canaris" />
        <div class="title">ASSISTENTE CANARIS</div>
      </div>
    </div>

    <div class="card">

      <!-- SCHERMATA 0: HOME (FOTO / FILTRI / CODICE) -->
      <div id="screenHome" class="screen">
        <div class="hero">
          <!-- LOGO GRANDE IN HOME -->
          <img class="heroLogoBig" src="logo-canaris.png" alt="Canaris" />
          <div class="camIcon">‚ú®</div>

          <div>
            <h1>Trova subito un abito simile</h1>
            <p class="sub">Scatta una foto, usa i filtri oppure inserisci il codice dell‚Äôabito.</p>
            <div class="hint">Consiglio: se puoi, inquadra l‚Äôabito intero e con uno sfondo pulito.</div>
          </div>

          <div class="actions">
            <button class="primary" id="btnGoPhoto">üì∏ Scatta una foto</button>
            <button class="secondary" id="btnGoFilters">üîé Trova con filtri</button>
            <button class="secondary" id="btnGoCode">‚å®Ô∏è Inserisci codice abito</button>
          </div>
        </div>
      </div>

      <!-- SCHERMATA 1: FOTO -->
      <div id="screenCapture" class="screen hidden">
        <div class="hero">
          <div class="camIcon">üì∑</div>
          <div>
            <h1>Scatta una foto dell‚Äôabito</h1>
            <p class="sub">Abito appeso, manichino o indossato. Una sola foto √® sufficiente.</p>
            <div class="hint">Tip: inquadra l‚Äôabito intero, senza sfondi troppo caotici.</div>
          </div>

          <div class="actions">
            <button class="primary" id="btnTakePhoto">üì∏ Scatta foto</button>
            <button class="secondary" id="btnUpload">üìÅ Carica dalla galleria</button>
            <button class="secondary" id="btnBackHome1">‚Üê Torna alla home</button>
          </div>
        </div>
      </div>

      <!-- SCHERMATA 1B: FILTRI -->
      <div id="screenFilters" class="screen hidden">
        <h2 class="sectionTitle">Trova con filtri</h2>
        <p class="sectionSub">Seleziona poche caratteristiche e scopri le alternative disponibili.</p>

        <div class="panel">
          <div>
            <label>LUNGHEZZA</label>
            <select id="fLength">
              <option value="">Seleziona‚Ä¶</option>
              <option value="ABITI LUNGHI">Abito lungo</option>
              <option value="ABITI CORTI">Abito corto</option>
            </select>
          </div>

          <div>
            <label>LINEA (FONDAMENTALE)</label>
            <select id="fLine">
              <option value="">Seleziona‚Ä¶</option>
              <option value="MORBIDO">Morbido</option>
              <option value="SCIVOLATO">Scivolato</option>
              <option value="SIRENA">Sirena</option>
              <option value="AMPIO">Ampio</option>
              <option value="TUBO">Tubo</option>
              <option value="CORTO DAVANTI LUNGO DIETRO">Corto davanti lungo dietro</option>
            </select>
          </div>

          <div>
            <label>SCOLLO (OPZIONALE)</label>
            <select id="fNeck">
              <option value="">Nessuno</option>
              <option value="SCOLLO A V">A V</option>
              <option value="OMERALE">Omerale</option>
              <option value="BRETELLA LARGA">Bretella larga</option>
              <option value="CUORE">Cuore</option>
              <option value="FASCIA">Fascia</option>
            </select>
          </div>

          <div>
            <label>COLORE (OPZIONALE)</label>
            <select id="fColor">
              <option value="">Nessuno</option>
              <option value="BLU">Blu</option>
              <option value="CIPRIA">Cipria</option>
              <option value="NERO">Nero</option>
              <option value="VERDE">Verde</option>
              <option value="ROSSO">Rosso</option>
              <option value="ALTRO">Altro</option>
            </select>
          </div>

          <p class="mini">Nota: oggi √® una demo. Poi i filtri useranno i tag Shopify (solo disponibili da ETOS).</p>

          <div class="row">
            <button class="primary" id="btnSearchByFilters">üîé Cerca abiti simili</button>
            <button class="secondary" id="btnBackHome2">‚Üê Home</button>
          </div>
        </div>
      </div>

      <!-- SCHERMATA 1C: CODICE -->
      <div id="screenCode" class="screen hidden">
        <h2 class="sectionTitle">Inserisci codice abito</h2>
        <p class="sectionSub">Se hai il codice, trovi subito alternative simili senza foto.</p>

        <div class="panel">
          <div>
            <label>CODICE PRODOTTO</label>
            <input id="codeInput" placeholder="Es. T00251" />
          </div>

          <p class="mini">Nota: oggi √® una demo. Poi leggeremo i tag del prodotto e cercheremo i simili.</p>

          <div class="row">
            <button class="primary" id="btnSearchByCode">üéØ Trova abiti simili</button>
            <button class="secondary" id="btnBackHome3">‚Üê Home</button>
          </div>
        </div>
      </div>

      <!-- SCHERMATA 2: ANTEPRIMA FOTO -->
      <div id="screenPreview" class="screen hidden">
        <div class="previewWrap">
          <h1 style="font-size:18px;margin:0;">Conferma la foto</h1>
          <img id="previewImg" class="previewImg" alt="Anteprima foto" />
          <div class="row">
            <button class="primary" id="btnUsePhoto">‚úÖ Usa questa foto</button>
            <button class="secondary" id="btnRetake">üîÅ Rifai</button>
          </div>
          <button class="danger" id="btnCancel">Annulla</button>
        </div>
      </div>

      <!-- SCHERMATA 3: RISULTATI (DEMO) -->
      <div id="screenResults" class="screen hidden">
        <div class="resultsHeader">
          <div>
            <h1 style="font-size:18px;margin:0;">Abiti simili</h1>
            <div class="line" id="resultsSubtitle">Risultati demo</div>
          </div>
          <div class="badge">3‚Äì5 top</div>
        </div>

        <div class="grid" id="resultsList"></div>

        <div class="foot">
          <button class="secondary" id="btnBackToHomeFromResults">‚Üê Home</button>
          <button class="primary" id="btnDone">Fatto</button>
        </div>
      </div>

      <div class="status" id="statusLine">
        Stato: pronta. (Demo ‚Äî poi colleghiamo Shopify + logica ‚Äúsimili‚Äù.)
      </div>
    </div>

    <!-- INPUT NASCOSTI -->
    <input id="inputCamera" type="file" accept="image/*" capture="environment" class="hidden" />
    <input id="inputGallery" type="file" accept="image/*" class="hidden" />

  </div>

<script>
  // SCREENS
  const screenHome    = document.getElementById('screenHome');
  const screenCapture = document.getElementById('screenCapture');
  const screenFilters = document.getElementById('screenFilters');
  const screenCode    = document.getElementById('screenCode');
  const screenPreview = document.getElementById('screenPreview');
  const screenResults = document.getElementById('screenResults');

  const statusLine = document.getElementById('statusLine');
  const resultsSubtitle = document.getElementById('resultsSubtitle');

  // HOME BUTTONS
  const btnGoPhoto = document.getElementById('btnGoPhoto');
  const btnGoFilters = document.getElementById('btnGoFilters');
  const btnGoCode = document.getElementById('btnGoCode');

  // PHOTO FLOW
  const btnTakePhoto = document.getElementById('btnTakePhoto');
  const btnUpload = document.getElementById('btnUpload');
  const btnBackHome1 = document.getElementById('btnBackHome1');

  const inputCamera = document.getElementById('inputCamera');
  const inputGallery = document.getElementById('inputGallery');

  const previewImg = document.getElementById('previewImg');
  const btnUsePhoto = document.getElementById('btnUsePhoto');
  const btnRetake = document.getElementById('btnRetake');
  const btnCancel = document.getElementById('btnCancel');

  // FILTERS
  const fLength = document.getElementById('fLength');
  const fLine = document.getElementById('fLine');
  const fNeck = document.getElementById('fNeck');
  const fColor = document.getElementById('fColor');
  const btnSearchByFilters = document.getElementById('btnSearchByFilters');
  const btnBackHome2 = document.getElementById('btnBackHome2');

  // CODE
  const codeInput = document.getElementById('codeInput');
  const btnSearchByCode = document.getElementById('btnSearchByCode');
  const btnBackHome3 = document.getElementById('btnBackHome3');

  // RESULTS
  const resultsList = document.getElementById('resultsList');
  const btnBackToHomeFromResults = document.getElementById('btnBackToHomeFromResults');
  const btnDone = document.getElementById('btnDone');

  let currentBlobUrl = null;
  let currentFile = null;

  function show(screen){
    [screenHome, screenCapture, screenFilters, screenCode, screenPreview, screenResults]
      .forEach(s => s.classList.add('hidden'));
    screen.classList.remove('hidden');
  }

  function setStatus(txt){ statusLine.textContent = "Stato: " + txt; }

  // HOME NAV
  btnGoPhoto.addEventListener('click', () => {
    show(screenCapture);
    setStatus("pronta. scatta una foto.");
  });
  btnGoFilters.addEventListener('click', () => {
    show(screenFilters);
    setStatus("seleziona i filtri.");
  });
  btnGoCode.addEventListener('click', () => {
    show(screenCode);
    setStatus("inserisci il codice.");
  });

  btnBackHome1.addEventListener('click', () => { show(screenHome); setStatus("pronta."); });
  btnBackHome2.addEventListener('click', () => { show(screenHome); setStatus("pronta."); });
  btnBackHome3.addEventListener('click', () => { show(screenHome); setStatus("pronta."); });
  btnBackToHomeFromResults.addEventListener('click', () => { show(screenHome); setStatus("pronta."); });

  // PHOTO FLOW
  function handleFile(file){
    if(!file) return;
    currentFile = file;
    if(currentBlobUrl) URL.revokeObjectURL(currentBlobUrl);
    currentBlobUrl = URL.createObjectURL(file);
    previewImg.src = currentBlobUrl;
    show(screenPreview);
    setStatus("foto caricata. conferma o rifai.");
  }

  btnTakePhoto.addEventListener('click', () => {
    inputCamera.value = "";
    inputCamera.click();
  });

  btnUpload.addEventListener('click', () => {
    inputGallery.value = "";
    inputGallery.click();
  });

  inputCamera.addEventListener('change', e => handleFile(e.target.files[0]));
  inputGallery.addEventListener('change', e => handleFile(e.target.files[0]));

  btnRetake.addEventListener('click', () => {
    show(screenCapture);
    setStatus("pronta. scatta una nuova foto.");
  });

  btnCancel.addEventListener('click', () => {
    currentFile = null;
    if(currentBlobUrl) URL.revokeObjectURL(currentBlobUrl);
    currentBlobUrl = null;
    show(screenHome);
    setStatus("pronta.");
  });

  // DEMO RISULTATI
  function renderDemoResults(){
    const demo = [
      {name:"Abito lungo con spacco", info:"Colore simile ‚Ä¢ Linea simile", sizes:["42","44 DISP.","46"], okIndex:1},
      {name:"Abito scivolato elegante", info:"Dettaglio simile ‚Ä¢ Tono simile", sizes:["40","42 DISP.","44"], okIndex:1},
      {name:"Abito strutturato", info:"Alternativa vicina ‚Ä¢ Modello affine", sizes:["44 DISP.","46"], okIndex:0},
      {name:"Abito monospalla", info:"Variante stile ‚Ä¢ Colore vicino", sizes:["42","44 DISP."], okIndex:1},
      {name:"Abito con schiena aperta", info:"Dettaglio forte ‚Ä¢ Linea simile", sizes:["44 DISP.","48"], okIndex:0},
    ];

    resultsList.innerHTML = "";
    demo.slice(0,5).forEach((p, idx) => {
      const div = document.createElement('div');
      div.className = "item";
      div.innerHTML = `
        <div class="thumb">FOTO</div>
        <div class="meta">
          <div class="name">${idx+1}. ${p.name}</div>
          <div class="line">${p.info}</div>
          <div class="stock">
            ${p.sizes.map((s,i)=> `<span class="pill ${i===p.okIndex?'ok':''}">${s}</span>`).join('')}
          </div>
        </div>
      `;
      resultsList.appendChild(div);
    });
  }

  async function goResults(subtitle){
    show(screenResults);
    resultsSubtitle.textContent = subtitle || "Risultati demo";
    setStatus("elaborazione... (demo)");
    resultsList.innerHTML = "";
    await new Promise(r => setTimeout(r, 800));
    renderDemoResults();
    setStatus("risultati pronti. (demo)");
  }

  // FOTO -> RISULTATI
  btnUsePhoto.addEventListener('click', async () => {
    if(!currentFile) return;
    await goResults("Risultati trovati partendo dalla foto (demo)");
  });

  // FILTRI -> RISULTATI
  btnSearchByFilters.addEventListener('click', async () => {
    // Se vuoi renderlo obbligatorio: lunghezza e linea
    if(!fLength.value || !fLine.value){
      alert("Seleziona almeno LUNGHEZZA e LINEA.");
      return;
    }
    const sub = `Filtri: ${fLength.value} ‚Ä¢ ${fLine.value}` +
                (fNeck.value ? ` ‚Ä¢ ${fNeck.value}` : "") +
                (fColor.value ? ` ‚Ä¢ ${fColor.value}` : "");
    await goResults(sub + " (demo)");
  });

  // CODICE -> RISULTATI
  btnSearchByCode.addEventListener('click', async () => {
    const code = (codeInput.value || "").trim();
    if(!code){
      alert("Inserisci un codice prodotto (es. T00251).");
      return;
    }
    await goResults(`Codice: ${code} ‚Üí abiti simili (demo)`);
  });

  btnDone.addEventListener('click', () => {
    show(screenHome);
    setStatus("pronta.");
  });

  // AVVIO
  show(screenHome);
  setStatus("pronta.");
</script>
</body>
</html>

